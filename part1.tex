\part[Ablauf, Organisation und Umfeld]{Ablauf, Organisation und Umfeld
    }

\tableofcontents

\chapter{Aufgabenstellung}

\section{Titel der Arbeit}
Hitobito: Neue Generation von Personen-Filtern

\section{Thematik}
Eines der Kernfunktionalitäten von Hitobito ist das Filtern via vom Benutzer definierten Kriterien von Personen auf Personenlisten und Abos. Diese Funktionalität ist in den über 10 Jahren seit es Hitobito gibt oft erweitert worden. Durch die vielen neuen Filtermöglichkeiten wurde speziell das UI immer komplexer und unübersichtlicher. Die Personen-Filteroptionen für Personenlisten und die der Abos sehen ähnlich aus, weisen aber diverse nicht offensichtliche Unterschiede auf. Mit dieser Probe-IPA soll für den Backendteil der Abos (MailingLists) eine neue Generation von Personen-Filtern für Hitobito entwickelt werden.

\section{Ausgangslage}
Hitobito ist eine Open Source Webapplikation zum Verwalten von Mitgliedern, Events und vielem mehr. Die Ruby on Rails Applikation wurde 2012 von Puzzle ITC initiiert und wird stets weiterentwickelt.

Die Basis für die Software bildet das Webframework Ruby on Rails. Für das User Interface wird neben statischer Technologie wie HTML und CSS auch JavaScript oder Hotwire verwendet. Der komplette Source-Code steht auf Github zur Verfügung: https://github.com/hitobito

\section{Detaillierte Aufgabenstellung}
Mit dieser Probe-IPA soll ein neues Konzept und Datenmodell für die Persistierung von Filter-Parametern erstellt werden (rein Backend). Anschliessend soll dieses Konzept in einem Proof of Concept (PoC) bei einem Teil der Mailinglisten (Abos) umgesetzt werden.

\begin{itemize}
    \item Die Klassen Subscription, RelatedRoleType, PeopleFilter, usw. werden im neuen Konzept komplett ersetzt oder ggf. ergänzt
    \item Eine Möglichkeit ist das PeopleFilter die Basis für das neue Konzept bilden
    \item Es sollen 2-3 Grobkonzepte gegenüber gestellt werden und das ausgewählte Konzept detaillierter ausgearbeitet werden
\end{itemize}

PoC

\begin{itemize}
\item Folgende Komponenten der MailingLists Filter sollen mit dem neuen Konzept im PoC umgesetzt werden:
    \begin{itemize}
        \item Globale Bedingungen > Sprache
        \item Personen
        \item Ausgeschlossene Personen
        \item Optional: Gruppen / Rollen
    \end{itemize}    
\item Persistierte Subscriptions/Filter müssen für den PoC vorerst nicht migriert werden
\item Die nicht erwähnten Komponenten müssen nicht mehr funktionieren
\item Die erwähnten Komponenten (ohne Optionale) funktionieren im UI und haben eine minimale, funktionierende Testabdeckung (happy path)
\end{itemize}

\newpage

Out of Scope - wird nicht oder erst nach der Probe IPA umgesetzt

\begin{itemize}
    \item Konzept und Anpassungen Frontend/UI
    \item PoC Umbau/Migration People Filter Personenlisten
    \item JSON API Filter (Grafiti)
\end{itemize}

\newpage

\subsection{Mittel und Methoden}

Technologie und Plattform:

\begin{itemize}
    \item Ruby, Ruby on Rails, Active Record
\end{itemize}

Entwicklungsumgebung:

\begin{itemize}
    \item Intellij
    \item Git, Github
    \item Rake
    \item Rubocop
\end{itemize}

Textverarbeitung und Diagramme:

\begin{itemize}
    \item Latex
    \item draw.io
    \item Google Sheets
\end{itemize}

Projektmethode:

\begin{itemize}
    \item Scrum IPA
\end{itemize}

Konventionen:

\begin{itemize}
    \item Es gilt der \href{https://github.com/rubocop-hq/ruby-style-guide}{Ruby Style Guide} und der \href{https://github.com/rubocop-hq/rails-style-guide}{Rails Style Guide} gemäss Rubocop \href{https://github.com/puzzle/cryptopus/blob/master/.rubocop.yml}{Konfiguration des Projekts}
\end{itemize}

\subsection{Vorkenntnisse}
Marc arbeitet bereits seit einigen Monaten an Features von Hitobito. Ausserdem hat er bereits seit dem 2. Lehrjahr Erfahrung auch in anderen Ruby on Rails Projekten gesammelt.

\subsection{Vorarbeiten}
\begin{itemize}
    \item Vorbereitung Dokumentvorlage
    \item Ist-Analyse Personen-Filter Personen-Listen/Abos
    \item Dokumentation in der Developer-Dokumentation der bestehenden Implementation von MailingLists, FilteredList, Personen-Filter
\end{itemize}

\subsection{Neue Lerninhalte}

\begin{itemize}
    \item Eigenständiges Entwerfen der Datenstruktur/Klassen
\end{itemize}

\subsection{Arbeiten in den letzten 6 Monaten}

\begin{itemize}
    \item Umsetzung diverser Features für Hitobito (Ruby on Rails)
    \item Postgresql Migration Hitobito
\end{itemize}

\chapter{Firmenstandards}

\section{Code conventions}
Als Code convention werden die Ruby \href{https://github.com/rubocop/ruby-style-guide}{Style Guides} verwendet. 
Die Überprüfung dieser Style Guidelines wird mit Rubocop (Formatter) sichergestellt. Die Konfiguration
dieses Formatters ist unter \href{https://github.com/hitobito/hitobito/blob/master/.rubocop.yml}{rubocop.yml} ersichtlich.

\subsection{Lizenz}
In jedem File in Hitobito wird das Copyright für den jeweiligen Kunden und die Lizenz dazu
in Kommentarform beschrieben. Diese Lizenz- sowie Kundeninformationen können über folgenden Befehl 
eingefügt werden.

\begin{verbatim}
    rake license:insert
\end{verbatim}
    
Alternativ dazu können diese Informationen mit 

\begin{verbatim}
    rake license:remove 
\end{verbatim}

entfernt oder mit 

\begin{verbatim}
    rake license:update 
\end{verbatim} aktualisiert werden.

\newpage

\section{Git conventions}
Für das cloudbasierte Hosting unseres Git-Repositories wird Github verwendet. 
Die Git Commitnachrichten werden nach den Regeln von Puzzle ITC formuliert. Im Anhang
unter \hyperref[sec:gitconv]{Git Conventions} finden sie eine Kopie unserer Firmenkonventionen

\begin{itemize}
    \item Sprache: Englisch
    \item Kurze und prägnante Message, idealerweise unter 50 Zeichen \href{https://cbea.ms/git-commit/#limit-50}{Details}
    \item Mit Grossbuchstaben beginnen \href{https://cbea.ms/git-commit/#capitalize}{Details}
    \item Kein Punkt am Schluss \href{https://cbea.ms/git-commit/#end}{Details}
    \item Den \textit{imperative mood} (Befehlsform) verwenden, also «Fix bug with X» statt «Fixed bug with X» oder «More fixes for broken stuff» \href{https://cbea.ms/git-commit/#imperative}{Details}
    \item Wenn vorhanden Ticket referenzieren:
    \begin{itemize}
        \item Bei Open Project Work Packages: «Add X, refs \#12345»
        \item Bei Gitlab/Github Issues: «Add X \#12345»
    \end{itemize}
\end{itemize}

\section{Documentation Conventions}
Als Documentation covention wird arc42 verwendet (Siehe \href{https://arc42.org/documentation/}{arc 42 documentation}). 

\newpage

\section{Security Conventions}
\begin{itemize}
    \item{Injection / Cross Size Scripting}
    \begin{itemize}
        \item{Input Validierung von allen Inputs serverseitig durchführen}
        \item{Output Encoding auf allen Outputs anwenden}
        \item{Kein inline oder dynamisches SQL, sondern parametrisierte Queries verwenden}
        \item {Datei Uploads überprüfen}
    \end{itemize}
    \item Verbindungs- / Browsersicherheit
    \begin{itemize}
        \item{Nur HTTPS verwenden und korrekt konfigurieren}
        \item{Security Headers setzen}
        \item{Cookie Flags secure, httpOnly und SameSite setzen}
        \item{Kein Caching von sensiblen Informationen}
    \end{itemize}

    \item Authentication / Sessions
    \begin{itemize}
        \item{IAM des Frameworks oder besser Keycloak verwenden}
        \item{Keine sensitiven Infos in URL Parameter}
        \item{Brute Force Schutz}
        \item{ Sessions schützen}
    \end{itemize}
    \item Tools und Betriebsumgebung
    \begin{itemize}
        \item{Errorhandling und Logging}
        \item{Libraries und deren Dependencies auf bekannte Schwachstellen prüfen}
        \item{OS, Webserver, Container aktuell halten und Hardening}
        \item{Keine Produktionsdaten auf Integrationsumgebungen}
    \end{itemize}
    \item Security Testing
    \begin{itemize}
        \item{Es dürfen keine Secrets im Repository abgelegt werden}
        \item{Eingebundene Dependencies dürfen keine MEDIUM und HIGH Schwachstellen aufweisen}
        \item{Eine statische Codeanalyse sollte durchgeführt werden}
        \item{Eine dynamische Codeanalyse sollte durchgeführt werden}
        \item{Alle verwendeten Images sollten auf Schwachstellen gescannt werden}
    \end{itemize}
\end{itemize}

\chapter{IPA-Schutzbedarfanalyse}

\section{Datensicherheit}
Die notwendigen Daten welche im Rahmen der IPA zu Test- und Vorführungszwecken verwendet werden,
sind werden durch das \href{https://github.com/faker-ruby/faker}{Faker-Gem} generiert und sind somit NICHT 
besonders schützenswert. Dazu gehören unter anderem Adressen, Familiendaten, Finanzdaten.

\section{Applikationssicherheit}
Obwohl im Rahmen der IPA nicht mit besonders schützenswerten Daten gearbeitet muss bei der Programmierung beachtet werden,
dass bei den Filterungen stets auf ein Datenset zugegriffen wird welches durch das can-can-can-Gem validiert wurde um zu
Verhindern dass Personen auf die Daten anderer Zugriff haben. Dies ist wichtig, da sich bei späterer Implementierung der IPA in 
Hitobito besonders Schützenswerte Daten in der Datenbank befinden. Das Datenschutzkonzept dafür finden sie

\chapter{Organisation der IPA-Ergebnisse}

\section{Datensicherung}
In dieser IPA unterteilen wir die Datensicherung in:

\begin{itemize}
\item Dokumentation
\item Code
\end{itemize}

\subsection{Dokumentation}
\begin{table}[h!]
      \begin{tabular}{|L{0.4\textwidth}|L{0.5\textwidth}|}
          \hline
          \rowcolor{puzzleblue} \multicolumn{2}{|l|}{\color{white}\textbf{Dokumentation}} \\[12pt]
          \hline
          Tools & Git und USB \\
          \hline
          Versioniert & Ja \\
          \hline
          Interval & Mind. 2x täglich \\
          \hline
          Beschreibung & Die Dokumentation ist im ipa-puzzle-template Repository unter dem Branch probe-ipa angelegt.
          Sobald ein Dokumentationsticket abgeschlossen wurde, werden die Änderungen auf den Github Server in das private Repository
          gepushed. Dies geschieht mind. 2x täglich. Zusätzlich, wird pro Tag ein Ordner auf einem USB-Stick erstellt.  Am Ende des Tages wird eine Kopie der Dokumentation
          in diesen Ordner geladen. \\
        \hline
        \end{tabular}
        \caption{Sicherung Dokumentation}
  \end{table}

\newpage

\subsection{Code}
\begin{table}[h!]
    \begin{tabular}{|L{0.4\textwidth}|L{0.5\textwidth}|}
        \hline
        \rowcolor{puzzleblue} \multicolumn{2}{|l|}{\color{white}\textbf{Code}} \\[12pt]
        \hline
        Tools & Git und USB \\
        \hline
        Versioniert & Ja \\
        \hline
        Interval & Mind. 2x täglich \\
        \hline
        Beschreibung & Für die Entwicklung habe wurden die Repositories hitobito und hitobito\-generic geforked.
        Auf diesen Repositories wird an Tagen an welchen Entwickelt wird, mind. 2x täglich committed. An diesen Tagen
        wird zur doppelten Sicherung zusätzlich eine Kopie des Projektes auf den USB Stick gespeichert, unter dem Ordner des jeweiligen Tages. \\
      \hline
      \end{tabular}
      \caption{Sicherung Code}
\end{table}

\subsection{Wiederherstellung des Codes}
Gehen die Daten lokal verloren, können diese entweder über das Github Repository oder den USB-Stich wiederhergestellt werden.
Bei der Wiederherstellung mit Git, wird der SSH-Key des Repositories benötigt, damit dieses von Github geklont werden kann. Ist
dieser SSH-Key nicht verfügbar, wird die Wiederherstellung über den USB-Stick vorgenommen und das Projekte des letzten Speicherstandes
kopiert. Im Falle des USB-Sticks sind mit mehr Datenverlusten zu rechnen, falls der Datenverlust gegen Mittag oder Nachmittag auftritt, da
die Speicherung erst am Ende des Tages erfolgt. Aus diesem Grund ist die Datenwiederherstellung mit Git zu bevorzugen.

Die Nachweise für die jeweiligen Datensicherungen finden sie im Anhang unter: TODO(Screenshots in Anhang einfügen)
\begin{itemize}
    \item \hyperref[sec:savusb]{USB-Sicherung}
    \item \hyperref[sec:savgit]{Git-Sicherung}
\end{itemize}

\chapter{Projektmethode}
Die verwendete Projektmethode dieser IPA ist SCRUM. Abweichungen und Werkzeuge welcher der Umsetzung
dieser IPA nach SCRUM verwendet werden, sind im folgenden Abschnitt beschrieben.

\section{Github Board}
Um die Userstories, Aufwandschätzungen und den Projektstatus zu verfolgen verwende ich Github Projects. 

\subsection{Backlog}
Zu Beginn der IPA wurde ein Backlog erstellt indem alle User Stories aufgeführt werden. Die Stories im Backlog
müssen noch nicht detailliert spezifiziert sein, sie dienen dazu eine Übersicht über noch offene Aufgaben während
der IPA zu erhalten.

\subsection{Refinement}
In der Refinement Spalte werden die Userstories vor dem Sprint Planning detaillierter beschrieben und mit Akzeptanzkriterien versehen. 
Der Detailbeschrieb dient dazu die Story später im Sprint Planning besser schätzen zu können.
Falls eine Userstory zu gross wird, wird sie in dieser Spalte auf zwei oder mehrere Stories unterteilt. Ausserdem werden pro Userstory Akzeptanzkriterien
definiert welche erfüllt werden müssen um diese während des Sprints abzuschliessen.

\newpage

\subsection{Sprint Backlog}
Anfangs Sprint wird immer ein Sprint Planning durchgeführt. Dabei werden die Userstories geschätzt und in den Sprint Backlog gezogen. 
Am Ende des Sprints sollte der Sprint Backlog leer sein. Ist dies nicht der Fall muss die Story zurück ins Refinement, neu beschrieben werden 
(falls Änderungen aufgetaucht sind) und muss dann in den nächsten Sprint weitergezogen werden.

\subsection{In Progress}
Während des Sprints werden Ticket in die In Progress-Spalte geschoben sobald die Arbeit daran beginnt.

\subsection{Done}
Eine Userstory kann in die Done-Spalte gezogen werden, wenn alle Akzeptanzkriterien erfüllt wurden.
Die Story gilt danach als abgeschlossen.

\section{Sprints}
Die gesamte IPA wird in drei Sprints unterteilt, diese umfassen je eine der folgenden
Phasen:

\begin{itemize}
\item Initialisierung
\item Umsetzung
\item Finalisierung    
\end{itemize}

Jedes Ticket wurde mit einem der Phasen gelabeled. So kann abgeschätzt werden, welche Tickets in welchem
Sprint erledigt werden müssen.

\section{Sprint Planning}
Das Planning findet immer zu Beginn des nächsten Sprints statt. Während des Sprint Plannings werden die zu erledigenden
Stories vom Refinement in den Sprint Backlog geschoben und geschätzt. Um die Planung im Zeitplan
besser darzustellen, wird definiert dass die Stories in Stunden anstatt Story Points geschätzt werden. Die niedrigste Schätzung
entspricht dabei einem Betrag von 0.5 Stunden.

\section{Daily}
Jeden Morgen findet ein Daily mit der verantwortlichen Fachkraft und der zusätzlichen verantwortlichen Fachkraft statt
welche den Stand des Sprintes prüfen und offene Fragen von mir beantworten. Ausserdem präsentiere ich im Daily den Stand der 
Dokumentation welche meine zuständigen Fachkräfte prüfen und mir Tipps zur Verbesserung geben. 

\section{Verwendungsgrund}
Die Projektvorgehensmethod wurde so gewählt, da sie für die IPA mehrere Vorteile bringt:

\begin{itemize}
    \item \textbf{Sprint Ende:} SCRUM zwingt den Entwickler dazu am Ende des Sprintes ein brauchbares Produkt zu haben
    \item \textbf{Agilität:} Wenn eine Story nicht erreicht wurde, kann sie in den nächsten Sprint gezogen werden
    \item \textbf{Daily:} Durch die Dailies wird ein täglicher Austausch zwischen Fachkraft und Kandidat sichergestellt
    \item \textbf{Akzeptanzkriterien:} Mit den Kriterien verhindern wir das abschliessen von halbfertigen Features oder fehlerhafter Software
    \item \textbf{Board:} Durch das Github Projects Board ermöglichen wir eine schnelle Übersicht über den Stand der IPA

\end{itemize}

\chapter{Projektaufbauorganisation}
\section{Projektrollen in Scrum}
\begin{figure}[h]
    \centering
    \includegraphics[width=1\textwidth,]{scrum_roles.drawio.png}
    \caption{Rollen in Scrum}
\end{figure}


\begin{table}[h!]
        \begin{tabular}{|L{0.4\textwidth}|L{0.5\textwidth}|}
            \hline
            \rowcolor{puzzleblue} \multicolumn{2}{|l|}{\color{white}\textbf{Rollenbeschreibung}} \\[12pt]
            \hline
            Product Owner & Der Product Owner vertritt die Interessen des Kunden. Er priorisiert die Aufgaben im Product Backlog  \\
            \hline
            Scrum Master & Der Scrum Master coached die Entwickler und beseitigt Hindernisse. Er sorgt für eine 
            kontinuierliche Verbesserung in der Arbeit. \\
            \hline
            Entwicklerteam & Das Entwicklerteam arbeitet selbstorganisiert den Sprint Backlog ab. 
            Durch Dailies wird ein laufender Informationsaustausch sichergestellt. \\
            \hline
          \end{tabular}
          \caption{Rollenbeschreibung}
\end{table}

\section{Projektrollen IPA}
\begin{table}[h!]
    \begin{tabular}{|L{0.4\textwidth}|L{0.5\textwidth}|}
        \hline
        \rowcolor{puzzleblue} \multicolumn{2}{|l|}{\color{white}\textbf{Rollenbeschreibung}} \\[12pt]
        \hline
        Verantwortliche Fachkraft & Unterstützt den Kandidaten von seiten des Lehrbetriebes. Erste Anlaufstelle bei Problemen.  \\
        \hline
        Zusätzliche verantwortliche Fachkraft & Unterstützung für die verantwortliche Fachkraft \\
        \hline
        Experten & \textbf{Validierungsexperte:} Validiert die IPA-Aufgabenstellung.
                    \textbf{Hauptexperte:} Verantwortlich für die Bewertung der IPA.
                    \textbf{Nebenexperte:} Unterstützung für den Hauptexperten. \\ 
        \hline
      \end{tabular}
      \caption{Rollenbeschreibung}
\end{table}

\newpage

\section{Rollenverteilung}
\begin{figure}[h]
    \centering
    \includegraphics[width=1\textwidth,]{rollenverteilung_ipa.drawio.png}
    \caption{Rollen in Scrum}
\end{figure}

\begin{table}[h!]
    \begin{tabular}{|L{0.4\textwidth}|L{0.5\textwidth}|}
        \hline
        \rowcolor{puzzleblue} \multicolumn{2}{|l|}{\color{white}\textbf{Rollenbeschreibung IPA}} \\[12pt]
        \hline
        Verantwortliche Fachkraft & Daniel Illi  \\
        \hline
        Zusätzliche verantwortliche Fachkraft & Robin Steiner \\
        \hline
        Validierungsexperte & Lawson Mike \\ 
        \hline
        Hauptexperte & Lorenz Hess \\ 
        \hline
        Nebenexperte & Michael Moser \\ 
        \hline
        Scrum Master & Marc Egli \\ 
        \hline
        Development Team & Marc Egli \\ 
        \hline
        Kandidat & Marc Egli \\ 
        \hline
      \end{tabular}
      \caption{Rollenbeschreibung IPA}
\end{table}


\input{zeitplan.tex}

\chapter{Arbeitsjournale}
\input{journal/tag1.tex}
\input{journal/tag2.tex}
\input{journal/tag3.tex}
\input{journal/tag4.tex}
\input{journal/tag5.tex}
\input{journal/tag6.tex}

\chapter{Persönliches Fazit}